out vec4 output_color; // "output_color" replaces "gl_FragColor" because glBindFragDataLocation(...) has been called

uniform sampler2D fire;

in vec2 vs_position;
in vec2 vs_texcoord;
in vec4 vs_color;

uniform vec4 camera_box;
uniform vec4 world_box;

void main()
{
  float world_size = length(world_box.zw);

  vec2  pos   = camera_box.xy + camera_box.zw * vs_position;
  vec2  delta = pos - world_box.xy;
  float l = length(delta);

  float factor = l / world_size;
  factor = (factor - 0.7) / 0.3;  

  float angle = atan(delta.y, delta.x);
  angle = (angle / 3.141592653589) * 0.5 + 0.5;
  
  vec2 tex = vec2(angle, factor);
  output_color = texture(fire, tex);
  output_color.xyz *= factor;
}